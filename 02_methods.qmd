---
title: "02_methods"
description: |
    Supporting notebook for calculating basic statistics related to the papers corpus. See the **Methods** section in the final article.
    
#execute:
#  echo: false
format: 
  html:
    toc: true
    embed-resources: true  # Self-contained
    code-fold: true
    code-summary: "Show the code"
    code-tools: true
---


```{r}
#| label: load-packages
#| message: false

library(here)
library(tidyverse)
library(dplyr)
library(scales)
library(stringr)
library(gt)
library(ggplot2)
```


```{r}
#| label: load-data
#| message: false

papers <- 
  readr::read_csv(here::here("data-clean", "all-data.csv"))

papers <- 
  papers |>
  dplyr::select(conf, paper, year) |>
  dplyr::arrange(conf, year)


```

## Data collection and paper corpus

Selected/relevant columns are: `{r} stringr::str_flatten_comma(names(papers))`. More details [here](https://github.com/nuest/reproducible-research-giscience-longitudinal-study/tree/main/data-clean).


```{r}
#| label: basic-counts
#| message: false

n_papers <- nrow(papers)
n_papers_agile <- 
  papers |>
  count(conf) |>
  filter(conf == "agile") |>
  pull(n)

n_papers_giscience <- 
  papers |>
  count(conf) |>
  filter(conf == "giscience") |>
  pull(n)
```

Total number of papers: **`{r} n_papers`**: `{r} n_papers_agile` AGILE papers and `{r} n_papers_giscience` GIScience papers.

@tbl-papers below corresponds to the **Table 1: Paper corpus** of the published paper. 

```{r}
#| label: tbl-papers
#| tbl-cap: "Distribution of conference papers"

papers |>
  dplyr::group_by(conf) |>
  dplyr::count(year) |>
  dplyr::arrange(year, desc(n)) |>
  gt::gt() |>
  gt::tab_header(
    title = stringr::str_glue("Distribution of conference papers (N={n_papers})"),
    subtitle = md("*Table 1* of the published paper")
  ) |>
  gt::summary_rows(
    groups = everything(),
    columns = n,
    fns = list(
      label = md("**Total**"),
      fn = "sum")
  ) |>
  ## Draft solution. Instead, create own func to give total of papers per group without transitions year
  gt::summary_rows(
    groups = c("agile"),
    columns = n,
    fns = list(label = md("**Total w/o transition year**"), id = "transition_agile") ~ (sum(.)-22)  
  ) |>
  gt::summary_rows(
    groups = c("giscience"),
    columns = n,
    fns = list(label = md("**Total w/o transition year**"), id = "transition_agile") ~ (sum(.)-16)  
  ) |>
  gt::cols_label(
    year = md("**Year**"),
    n = md("**#**"),
    
  )

```

## Assessing potential reproducibility

@tbl-batches below corresponds to the **Table 2: Conference series grouped into batches for A2â€™s assessment** of the published paper.


```{r}
#| label: tbl-batches
#| tbl-cap: "Distribution of conference series in batches"

papers |>
  dplyr::mutate(
    batch = 
      dplyr::case_when(
        (conf == "agile" & year == 2019) ~ 1,
        (conf == "agile" & year == 2021)  ~ 1,
        (conf == "giscience" & year == 2020) ~ 1,
        (conf == "giscience" & year == 2021)  ~ 1,
        (conf == "agile" & year == 2018) ~ 2,
        (conf == "agile" & year == 2022)  ~ 2,
        (conf == "giscience" & year == 2018) ~ 2,
        (conf == "agile" & year == 2017) ~ 3,
        (conf == "agile" & year == 2023)  ~ 3,
        (conf == "giscience" & year == 2023) ~ 3,
        (conf == "agile" & year == 2020) ~ 4,
        (conf == "agile" & year == 2024)  ~ 4,
        (conf == "giscience" & year == 2016) ~ 4,
        TRUE ~ 0)
    ) |>
  dplyr::count(batch) |>
  gt::gt() |>
  gt::tab_header(
    title = stringr::str_glue("Distribution of conference series in batches (N={n_papers})"),
    subtitle = md("*Table 2* of the published paper")
  ) |>
  gt::cols_label(
    batch = md("**Batch**"),
    n = md("**#**"),
  )
```


