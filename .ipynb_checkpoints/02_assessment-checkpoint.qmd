---
title: "02_assessment (IN PROGRESS)"
format: 
  html:
    code-fold: true
    code-summary: "Show the code"
    code-tools: true
---

The majority of the work has been the evaluation of the papers, the consolidation of the assessments, and the **synthesis of the rich feedback** as well as interpretation of our findings. Here, we retrieve data items required to explore feedback from reviewers during the assessment process. Individual scores of CP, data, methods, results (Computational environment is not useful at reviewer level), and notes from the two reviewers and types of disagreement between reviewers are relevant here.


```{r}
#| label: load-packages
#| message: false

library(here)
library(tidyverse)
library(scales)
library(stringr)
library(gt)
```


```{r}
#| label: load-data
#| message: false

assessment <- 
  readr::read_csv(here::here("data-clean", "all-data.csv"))

assessment <- 
  assessment |>
  dplyr::select(conf, paper, year, 
                rev1, rev1_cp, rev1_data, rev1_methods, rev1_results, rev1_notes,
                rev2, rev2_cp, rev2_data, rev2_methods, rev2_results, rev2_notes,
                disagr_type, disagr_id) |>
  dplyr::arrange(conf, year)

  


```

Selected columns are: `{r} stringr::str_flatten_comma(names(assessment))`.


```{r}
#| label: basic-indicators
#| message: false

n_papers <- nrow(assessment)
n_papers_agile <- 
  assessment |>
  count(conf) |>
  filter(conf == "agile") |>
  pull(n)


n_papers_giscience <- 
  assessment |>
  count(conf) |>
  filter(conf == "giscience") |>
  pull(n)

#n_cp <- nrow(filter(assessment, consolidated_cp == TRUE))
#p_cp <- n_cp / n_papers
#- Number of `CP` papers: `{r} n_cp` (`{r} scales::label_percent(accuracy = 0.1)(p_cp)`)
#- Number of eligible papers for analysis: `{r} n_papers - n_cp` (`{r} scales::label_percent(accuracy = 0.1)(1 - p_cp)`)



```


## Types of disagreements


```{r}
#| label: tbl-disagr-types-general

assessment |>
  dplyr::count(disagr_type) |>
  dplyr::mutate(p = n /sum(n)) |>
  dplyr::arrange(desc(n)) |>
  gt::gt() |>
  gt::tab_header(
    title = "Distribution of disagreement types",
    subtitle = stringr::str_glue("Number per types (N={n_papers})")
  ) |>
  gt::fmt_percent(
    columns = p,
    decimals = 1
  ) |>
  gt::tab_style(
    style = cell_text(color = "#ae8b2d", weight = "bold"),
    locations = cells_body(
      columns = everything(),
      rows = n == max(n)
    )
  ) |>
  gt::cols_label(
    disagr_type = md("**Disagreement type**"),
    n = md("**#**"),
    p = md("**%**")
  )
```


```{r}
#| label: tbl-disagr-types-per-conf

assessment |>
  dplyr::group_by(conf) |>
  dplyr::count(disagr_type) |>
  dplyr::mutate(p = n /sum(n)) |>
  dplyr::arrange(conf, desc(n)) |>
  gt::gt() |>
  gt::tab_header(
    title = "Distribution of disagreement types",
    subtitle = stringr::str_glue("Grouped by conference (N={n_papers})") 
  ) |>
  gt::fmt_percent(
    columns = p,
    decimals = 1
  ) |>
  gt::summary_rows(
    groups = everything(),
    columns = n,
    fns = list(
      total = "sum"
    )
  ) |>
  gt::cols_label(
    disagr_type = "",
    n = md("**#**"),
    p = md("**%**")
  )

```
```{r}
#| label: tbl-disagr-types-per-conf-year
#| tbl-cap: "Distribution of disagreement types per conf and year"
#| tbl-subcap: 
#|     - "AGILE"
#|     - "GIScience"
#| layout-ncol: 2

assessment |>
  dplyr::filter(conf =="agile") |>
  dplyr::group_by(year) |>
  dplyr::count(disagr_type) |>
  dplyr::mutate(p = n /sum(n)) |>
  dplyr::arrange(year, desc(n)) |>
  gt::gt() |>
  gt::tab_header(
    title = stringr::str_glue("AGILE conference only (N={n_papers_agile})")
  ) |>
  gt::fmt_percent(
    columns = p,
    decimals = 1
  ) |>
  gt::cols_label(
    disagr_type = "",
    year = md("Year"),
    n = md("**#**"),
    p = md("**%**")
  )

assessment |>
  dplyr::filter(conf =="giscience") |>
  dplyr::group_by(year) |>
  dplyr::count(disagr_type) |>
  dplyr::mutate(p = n /sum(n)) |>
  dplyr::arrange(year, desc(n)) |>
  gt::gt() |>
  gt::tab_header(
    title = stringr::str_glue("GIScience conference only (N={n_papers_giscience})")
  ) |>
  gt::fmt_percent(
    columns = p,
    decimals = 1
  ) |>
  gt::cols_label(
    disagr_type = "",
    year = md("Year"),
    n = md("**#**"),
    p = md("**%**")
  )

```

